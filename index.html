<script>
(() => {
  const wrap = document.getElementById('portal');
  const canvas = document.getElementById('net');
  const ctx = canvas.getContext('2d');
  const DPR = Math.min(2, window.devicePixelRatio || 1);

  let W, H, t0 = performance.now();

  // Nodos del portal
  const nodes = [
    { id:"lia-rebelde", label:"Lía la IA rebelde", url:"https://guardianesdelia.world/lia-la-ia-rebelde/", color:"#38f5ff", base:7 },
    { id:"singularidad", label:"La Singularidad de LIA", url:"#", color:"#ff6cfb", base:6 },
    { id:"odisea", label:"La Odisea Intergaláctica", url:"#", color:"#ffd36c", base:6 },
    { id:"guardianes", label:"LIA y los Guardianes del Tiempo", url:"#", color:"#8a5cff", base:6 }
  ];

  function resize(){
    W = wrap.clientWidth;
    H = wrap.clientHeight;
    canvas.width = W * DPR;
    canvas.height = H * DPR;
    canvas.style.width = W+'px';
    canvas.style.height = H+'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);

    // distribuir en círculo
    const cx = W/2, cy = H/2, r = 140;
    nodes.forEach((n,i)=>{
      const ang = (i / nodes.length) * Math.PI*2 - Math.PI/2;
      n.x = cx + Math.cos(ang)*r;
      n.y = cy + Math.sin(ang)*r;
    });
  }
  window.addEventListener('resize', resize);
  resize();

  // Dibujar nodo
  function drawNode(n, t){
    const beat = Math.sin(t*2+ n.base);
    const size = n.base + 2 + beat*1.5;
    ctx.save();
    ctx.shadowBlur = 20;
    ctx.shadowColor = n.color;
    const grad = ctx.createRadialGradient(n.x,n.y,0,n.x,n.y,size);
    grad.addColorStop(0,"#fff");
    grad.addColorStop(0.4,n.color);
    grad.addColorStop(1,"transparent");
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(n.x,n.y,size,0,Math.PI*2);
    ctx.fill();
    ctx.restore();

    // Label futurista
    ctx.font = "14px 'Orbitron', sans-serif";
    ctx.fillStyle = "#fff";
    ctx.textAlign = "center";
    ctx.shadowColor = n.color;
    ctx.shadowBlur = 12;
    ctx.fillText(n.label, n.x, n.y + size + 20);
  }

  // Detectar clic
  wrap.addEventListener("click",(e)=>{
    const r = wrap.getBoundingClientRect();
    const mx = e.clientX - r.left;
    const my = e.clientY - r.top;
    nodes.forEach(n=>{
      if(Math.hypot(mx-n.x,my-n.y) < 30){
        window.location.href = n.url;
      }
    });
  });

  function loop(){
    const t = (performance.now()-t0)/1000;
    ctx.clearRect(0,0,W,H);

    // enlaces
    ctx.strokeStyle="rgba(138,92,255,0.4)";
    ctx.lineWidth=1.2;
    nodes.forEach((a,i)=>{
      nodes.slice(i+1).forEach(b=>{
        ctx.beginPath();
        ctx.moveTo(a.x,a.y);
        ctx.lineTo(b.x,b.y);
        ctx.stroke();
      });
    });

    // nodos
    nodes.forEach(n=> drawNode(n,t));
    requestAnimationFrame(loop);
  }
  loop();
})();
</script>
