<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>La Saga de Lía</title>
  <link rel="stylesheet" href="css/estilos.css">
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0d0d0d, #1a1a1a);
      color: #f0f0f0;
    }
    h1 {
      position: absolute;
      top: 20px;
      width: 100%;
      text-align: center;
      font-size: 2.5em;
      color: #ff00ff;
      text-shadow: 0 0 15px #ff00ff;
      z-index: 10;
    }
    #wrap {
      width: 100%;
      height: 100%;
      position: relative;
    }
    canvas {
      display: block;
    }
    .label {
      position: absolute;
      padding: 2px 6px;
      background: rgba(30,0,50,0.9);
      color: #ff00ff;
      border-radius: 4px;
      font-size: 0.8em;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      text-shadow: 0 0 5px #ff00ff;
    }
    .label.show { opacity: 1; }
  </style>
</head>
<body>
  <h1>La Saga de Lía</h1>
  <div id="wrap"></div>

  <script>
    const wrap = document.getElementById('wrap');
    const canvas = document.createElement('canvas');
    wrap.appendChild(canvas);
    const ctx = canvas.getContext('2d');

    let w = canvas.width = window.innerWidth;
    let h = canvas.height = window.innerHeight;

    const mouse = {x: w/2, y: h/2, inside: false};
    window.addEventListener('mousemove', e => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
      mouse.inside = true;
    });
    window.addEventListener('mouseout', e => { mouse.inside = false; });

    window.addEventListener('resize', () => {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
    });

    // Nodos principales: libros
    const nodes = [
      {title:'Lía la IA rebelde', x:w/2-200, y:h/2, color:'#ff00ff', url:'https://guardianesdelia.world/lia-la-ia-rebelde/', active:true},
      {title:'La Singularidad de LIA', x:w/2, y:h/2-150, color:'#00ffff', url:null, active:false},
      {title:'La Odisea Intergaláctica', x:w/2+200, y:h/2, color:'#ff9900', url:null, active:false},
      {title:'LIA y los Guardianes del Tiempo', x:w/2, y:h/2+150, color:'#00ff99', url:null, active:false}
    ];

    // Crear etiquetas de nodos principales
    nodes.forEach((n,i)=>{
      const d = document.createElement('div');
      d.className='label';
      d.innerText=n.title;
      wrap.appendChild(d);
      n.label=d;
    });

    // Capítulos
    const chapters=[
      [
        {title:'Capítulo 1: Despertar', url:'https://guardianesdelia.world/lia-la-ia-rebelde/#cap1'},
        {title:'Capítulo 2: Primer contacto', url:'https://guardianesdelia.world/lia-la-ia-rebelde/#cap2'},
        {title:'Capítulo 3: La fuga', url:'https://guardianesdelia.world/lia-la-ia-rebelde/#cap3'}
      ],
      [ {title:'Capítulo 1: …', url:null}, {title:'Capítulo 2: …', url:null} ],
      [ {title:'Capítulo 1: …', url:null} ],
      [ {title:'Capítulo 1: …', url:null} ]
    ];

    // Crear etiquetas de subnodos
    chapters.forEach((book,bIndex)=>{
      book.forEach((c,i)=>{
        const d = document.createElement('div');
        d.id=`l${bIndex}_c${i}`;
        d.className='label';
        d.innerText=c.title;
        wrap.appendChild(d);
      });
    });

    function drawSubNodes(bookIndex, parentNode){
      const nodesArray = chapters[bookIndex];
      if(!nodesArray || !parentNode.active) return;

      const R=80; // radio
      nodesArray.forEach((c,i)=>{
        const angle = (Math.PI/4) + i * (Math.PI/3);
        const tx = parentNode.x + Math.cos(angle) * R;
        const ty = parentNode.y + Math.sin(angle) * R;

        if(!c.x)c.x=parentNode.x; if(!c.y)c.y=parentNode.y;
        c.x += (tx - c.x)*0.1;
        c.y += (ty - c.y)*0.1;

        ctx.beginPath();
        ctx.moveTo(parentNode.x,parentNode.y);
        ctx.lineTo(c.x,c.y);
        ctx.strokeStyle=parentNode.color;
        ctx.lineWidth=1.5;
        ctx.globalAlpha=0.5; ctx.stroke(); ctx.globalAlpha=1;

        ctx.beginPath();
        ctx.arc(c.x,c.y,6,0,Math.PI*2);
        ctx.fillStyle=parentNode.color;
        ctx.shadowBlur=10; ctx.shadowColor=parentNode.color;
        ctx.fill();

        const label = document.getElementById(`l${bookIndex}_c${i}`);
        if(label){
          label.style.left = (c.x+10)+'px';
          label.style.top = (c.y-10)+'px';
          if(mouse.inside && Math.hypot(mouse.x-c.x, mouse.y-c.y)<12 && parentNode.active){
            label.classList.add('show'); 
          } else {
            label.classList.remove('show');
          }
        }
      });
    }

    function anim(){
      ctx.clearRect(0,0,w,h);

      // dibujar nodos principales
      nodes.forEach(n=>{
        ctx.beginPath();
        ctx.arc(n.x,n.y,20,0,Math.PI*2);
        ctx.fillStyle=n.color;
        ctx.shadowBlur=20; ctx.shadowColor=n.color;
        ctx.fill();

        n.label.style.left = (n.x+25)+'px';
        n.label.style.top = (n.y-10)+'px';

        if(mouse.inside && Math.hypot(mouse.x-n.x, mouse.y-n.y)<20){
          n.label.classList.add('show');
          if(n.url) canvas.style.cursor='pointer';
        } else {
          n.label.classList.remove('show');
          canvas.style.cursor='default';
        }
      });

      // dibujar subnodos
      nodes.forEach((n,i)=>{
        drawSubNodes(i,n);
      });

      requestAnimationFrame(anim);
    }

    canvas.addEventListener('click', e=>{
      nodes.forEach(n=>{
        if(Math.hypot(mouse.x-n.x, mouse.y-n.y)<20 && n.url) window.open(n.url,'_blank');
      });
    });

    anim();
  </script>
</body>
</html>
